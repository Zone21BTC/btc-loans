{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Zone21 Provider Risk‑Score File",
  "description": "Schema for a single Bitcoin‑backed loan product treated as an independent provider. Source files contain ONLY raw inputs: 13 factor scores, explanatory notes, optional *evidence*, and metadata (including a unique slug). Derived outputs—bonus/critical penalties, final_score, risk_band—are generated automatically by CI and therefore *must not* appear in provider JSON files.",
  "type": "object",
  "additionalProperties": false,
  "required": ["provider_name", "slug", "version", "highlights", "factors"],
  "properties": {
    "provider_name": {
      "type": "string",
      "minLength": 1,
      "description": "Human‑readable name of the loan provider / product."
    },

    "slug": {
      "type": "string",
      "pattern": "^[a-z0-9-]+$",
      "minLength": 3,
      "description": "URL‑safe, lowercase kebab‑case identifier used to distinguish this provider (e.g., 'unchained', 'ledn-rehypothecated'). Must be unique across the repository."
    },

    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+$",
      "description": "Manual revision tag for this JSON file (e.g., '1.0', '2.1'). Increment whenever any factor score, note, or evidence changes so CI can flag outdated caches."
    },

    "highlights": {
      "type": "string",
      "minLength": 1,
      "description": "Short narrative summary of key strengths / weaknesses (1‑3 sentences)."
    },

    "status": {
      "type": "string",
      "enum": ["active", "inactive", "withdrawn"],
      "default": "active",
      "description": "Operational status of this loan product. Optional; defaults to 'active'."
    },

    "is_beta": {
      "type": "boolean",
      "description": "Optional flag indicating if the provider is a beta product. Beta providers will be sorted at the end of the aggregated list."
    },

    "notes": {
      "type": "string",
      "description": "Optional free‑form remarks not covered by factor notes."
    },

    "factors": {
      "type": "object",
      "description": "The 13 risk factors. Each key is required and contains an object with a mandatory score (0/2/4/7/10) and explanatory note plus an optional array of evidence items.",
      "additionalProperties": false,
      "required": [
        "collateral",
        "rehypothecation",
        "custody",
        "security_governance",
        "platform",
        "oracle",
        "liquidation_buffer",
        "rate_and_term",
        "transparency",
        "loan_currency",
        "privacy",
        "history",
        "jurisdiction"
      ],
      "properties": {
        "collateral": { "$ref": "#/definitions/factor" },
        "rehypothecation": { "$ref": "#/definitions/factor" },
        "custody": { "$ref": "#/definitions/factor" },
        "security_governance": { "$ref": "#/definitions/factor" },
        "platform": { "$ref": "#/definitions/factor" },
        "oracle": { "$ref": "#/definitions/factor" },
        "liquidation_buffer": { "$ref": "#/definitions/factor" },
        "rate_and_term": { "$ref": "#/definitions/factor" },
        "transparency": { "$ref": "#/definitions/factor" },
        "loan_currency": { "$ref": "#/definitions/factor" },
        "privacy": { "$ref": "#/definitions/factor" },
        "history": { "$ref": "#/definitions/factor" },
        "jurisdiction": { "$ref": "#/definitions/factor" }
      }
    }
  },

  "definitions": {
    "scoreEnum": {
      "type": "integer",
      "enum": [0, 2, 4, 7, 10]
    },

    "evidenceItem": {
      "type": "object",
      "required": ["link", "type"],
      "additionalProperties": false,
      "properties": {
        "link": {
          "type": "string",
          "format": "uri",
          "description": "Public URL to an image or PDF supporting the factor assessment."
        },
        "type": {
          "type": "string",
          "enum": ["image", "pdf"],
          "description": "File type of the evidence asset."
        }
      }
    },

    "factor": {
      "type": "object",
      "additionalProperties": false,
      "required": ["score", "note"],
      "properties": {
        "score": { "$ref": "#/definitions/scoreEnum" },
        "note": {
          "type": "string",
          "minLength": 3,
          "description": "Short explanation for the assigned score (1‑2 sentences)."
        },
        "evidence": {
          "type": "array",
          "items": { "$ref": "#/definitions/evidenceItem" },
          "description": "Optional list of evidence objects. May start empty; analysts can populate in later revisions."
        }
      }
    }
  }
}
